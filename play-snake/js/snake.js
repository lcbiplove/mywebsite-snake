var SNAKE=SNAKE||{};SNAKE.addEventListener=window.addEventListener?function(e,t,n,a){e.addEventListener(t,n,a)}:window.attachEvent?function(e,t,n){e.attachEvent("on"+t,n)}:void 0,SNAKE.removeEventListener=window.removeEventListener?function(e,t,n,a){e.removeEventListener(t,n,a)}:window.detachEvent?function(e,t,n){e.detachEvent("on"+t,n)}:void 0,SNAKE.Snake=SNAKE.Snake||function(){var e=[],t=function(){this.elm=null,this.elmStyle=null,this.row=-1,this.col=-1,this.xPos=-1e3,this.yPos=-1e3,this.next=null,this.prev=null};return function(n){if(n&&n.playingBoard){void 0===localStorage.jsSnakeHighScore&&localStorage.setItem("jsSnakeHighScore",1);var a=this,o=n.playingBoard,d=(0,1),l=-1,i=!0,s=!0,r=-1,c=[0,1,0,-1],u=[-1,0,1,0],m=[],g=[],p=80,h=!1,y=!1,k=document.getElementById("selectMode");k&&k.addEventListener("change",function(e){var t=(e=e||{}).target?parseInt(e.target.value):75;isNaN(t)?t=75:t<50&&(t=75),p=t,setTimeout(function(){document.getElementById("game-area").focus()},10)}),a.snakeBody={},a.snakeBody.b0=new t,a.snakeBody.b0.row=n.startRow||1,a.snakeBody.b0.col=n.startCol||1,a.snakeBody.b0.xPos=a.snakeBody.b0.row*o.getBlockWidth(),a.snakeBody.b0.yPos=a.snakeBody.b0.col*o.getBlockHeight(),a.snakeBody.b0.elm=f(),a.snakeBody.b0.elmStyle=a.snakeBody.b0.elm.style,o.getBoardContainer().appendChild(a.snakeBody.b0.elm),a.snakeBody.b0.elm.style.left=a.snakeBody.b0.xPos+"px",a.snakeBody.b0.elm.style.top=a.snakeBody.b0.yPos+"px",a.snakeBody.b0.next=a.snakeBody.b0,a.snakeBody.b0.prev=a.snakeBody.b0,a.snakeLength=1,a.snakeHead=a.snakeBody.b0,a.snakeTail=a.snakeBody.b0,a.snakeHead.elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),a.snakeHead.elm.className+=" snake-snakebody-alive",a.setPaused=function(e){y=e},a.getPaused=function(){return y},a.handleArrowKeys=function(e){if(h||y)return;a.snakeLength;let t=-1;switch(e){case 37:case 65:t=3;break;case 38:case 87:t=0;break;case 39:case 68:t=1;break;case 40:case 83:t=2}r!==d&&(l=t),(2!==Math.abs(t-d)&&i||s)&&(r=t,i=!1,s=!1)},a.go=function(){var e=a.snakeHead,t=a.snakeTail,n=o.grid;if(!0!==y){if(a.snakeTail=t.prev,a.snakeHead=t,n[t.row]&&n[t.row][t.col]&&(n[t.row][t.col]=0),-1!==r&&(d=r,-1!==l&&(r=l,l=-1)),i=!0,t.col=e.col+c[d],t.row=e.row+u[d],t.xPos=e.xPos+m[d],t.yPos=e.yPos+g[d],t.elmStyle||(t.elmStyle=t.elm.style),t.elmStyle.left=t.xPos+"px",t.elmStyle.top=t.yPos+"px",0===n[t.row][t.col])n[t.row][t.col]=1,setTimeout(function(){a.go()},p);else if(n[t.row][t.col]>0)a.handleDeath();else if(n[t.row][t.col]===o.getGridFoodValue()){if(n[t.row][t.col]=1,!a.eatFood())return void a.handleWin();setTimeout(function(){a.go()},p)}}else setTimeout(function(){a.go()},p)},a.eatFood=function(){e.length<=5&&v(10);for(var t,n=e.splice(0,5),d=n.length,l=a.snakeTail;d--;)t="b"+a.snakeLength++,a.snakeBody[t]=n[d],a.snakeBody[t].prev=l,a.snakeBody[t].elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),a.snakeBody[t].elm.className+=" snake-snakebody-alive",l.next=a.snakeBody[t],l=a.snakeBody[t];return a.snakeTail=a.snakeBody[t],a.snakeTail.next=a.snakeHead,a.snakeHead.prev=a.snakeTail,!!o.foodEaten()&&(new Audio("audio/eat.mp3").play(),!0)},a.handleDeath=function(){B(o.handleDeath)},a.handleWin=function(){B(o.handleWin)},a.rebirth=function(){h=!1,i=!0,s=!0,l=-1},a.reset=function(){if(!1!==h){for(var t,d=[],l=a.snakeHead.next;l!==a.snakeHead;)t=l.next,l.prev=null,l.next=null,d.push(l),l=t;a.snakeHead.next=a.snakeHead,a.snakeHead.prev=a.snakeHead,a.snakeTail=a.snakeHead,a.snakeLength=1;for(var i=0;i<d.length;i++)d[i].elm.style.left="-1000px",d[i].elm.style.top="-1000px",d[i].elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),d[i].elm.className+=" snake-snakebody-alive";e.concat(d),a.snakeHead.elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-dead\b/,""),a.snakeHead.elm.className+=" snake-snakebody-alive",a.snakeHead.row=n.startRow||1,a.snakeHead.col=n.startCol||1,a.snakeHead.xPos=a.snakeHead.row*o.getBlockWidth(),a.snakeHead.yPos=a.snakeHead.col*o.getBlockHeight(),a.snakeHead.elm.style.left=a.snakeHead.xPos+"px",a.snakeHead.elm.style.top=a.snakeHead.yPos+"px"}},v(10),m[0]=0,m[1]=o.getBlockWidth(),m[2]=0,m[3]=-1*o.getBlockWidth(),g[0]=-1*o.getBlockHeight(),g[1]=0,g[2]=o.getBlockHeight(),g[3]=0}function f(){var e=document.createElement("div");return e.className="snake-snakebody-block",e.style.left="-1000px",e.style.top="-1000px",e.style.width=o.getBlockWidth()+"px",e.style.height=o.getBlockHeight()+"px",e}function v(n){for(var a,d=f(),l=1;l<n;l++)(a=new t).elm=d.cloneNode(!0),a.elmStyle=a.elm.style,o.getBoardContainer().appendChild(a.elm),e[e.length]=a;(a=new t).elm=d,o.getBoardContainer().appendChild(a.elm),e[e.length]=a}function B(e){var t;t=localStorage.jsSnakeHighScore,a.snakeLength>t&&localStorage.setItem("jsSnakeHighScore",a.snakeLength),a.snakeHead.elm.style.zIndex=function(e){var t,n=0,a=0;for(t in e)e[t].elm.currentStyle?a=parseFloat(e[t].elm.style["z-index"],10):window.getComputedStyle&&(a=parseFloat(document.defaultView.getComputedStyle(e[t].elm,null).getPropertyValue("z-index"),10)),!isNaN(a)&&a>n&&(n=a);return n+1}(a.snakeBody),a.snakeHead.elm.className=a.snakeHead.elm.className.replace(/\bsnake-snakebody-alive\b/,""),a.snakeHead.elm.className+=" snake-snakebody-dead",h=!0,new Audio("audio/dead.mp3").play(),e()}}}(),SNAKE.Food=SNAKE.Food||function(){var e=0;function t(e,t){return Math.floor(Math.random()*(t+1-e))+e}return function(n){if(n&&n.playingBoard){var a,o,d=n.playingBoard,l=e++,i=document.createElement("div");i.setAttribute("id","snake-food-"+l),i.className="snake-food-block",i.style.width=d.getBlockWidth()+"px",i.style.height=d.getBlockHeight()+"px",i.style.left="-1000px",i.style.top="-1000px",d.getBoardContainer().appendChild(i),this.getFoodElement=function(){return i},this.randomlyPlaceFood=function(){d.grid[a]&&d.grid[a][o]===d.getGridFoodValue()&&(d.grid[a][o]=0);for(var e=0,n=0,l=0,s=d.grid.length-1,r=d.grid[0].length-1;0!==d.grid[e][n];)if(e=t(1,s),n=t(1,r),++l>2e4)return!1;return d.grid[e][n]=d.getGridFoodValue(),a=e,o=n,i.style.top=e*d.getBlockHeight()+"px",i.style.left=n*d.getBlockWidth()+"px",!0}}}}(),SNAKE.Board=SNAKE.Board||function(){var e=0;function t(e){var t,n=0,a=0;for(t in e)e[t].elm.currentStyle?a=parseFloat(e[t].elm.style["z-index"],10):window.getComputedStyle&&(a=parseFloat(document.defaultView.getComputedStyle(e[t].elm,null).getPropertyValue("z-index"),10)),!isNaN(a)&&a>n&&(n=a);return n+1}function n(){var e=0;return"number"==typeof window.innerWidth?e=window.innerWidth:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?e=document.documentElement.clientWidth:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth),e}function a(){var e=0;return"number"==typeof window.innerHeight?e=window.innerHeight:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?e=document.documentElement.clientHeight:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientHeight),e}return function(o){var d,l,i,s,r,c,u,m,g,p,h,y=this,k=e++,f=o||{},v=250,B=250,w=1,E=!1;function S(){(r=document.createElement("div")).setAttribute("id","playingField"),r.className="snake-playing-field",SNAKE.addEventListener(r,"click",function(){s.focus()},!1),(h=document.createElement("div")).className="snake-pause-screen",h.innerHTML="<div style='padding:10px;'>[Paused]<p/>Press [space] to unpause.</div>",(c=document.createElement("div")).className="snake-panel-component",c.innerHTML="Score: 1",(u=document.createElement("div")).className="snake-panel-component",u.innerHTML="Highscore: "+(void 0===localStorage.jsSnakeHighScore||0==localStorage.jsSnakeHighScore?1:localStorage.jsSnakeHighScore),m=function(){var e=document.createElement("div");e.id="sbWelcome"+k,e.className="snake-welcome-dialog";var t=document.createElement("div"),n="";document.getElementById("game-pad-wrapper").style.display="flex",f.fullScreen&&(n="On Windows, press F11 to play in Full Screen mode.",document.getElementById("game-pad-wrapper").style.display="none");t.innerHTML="<p></p>Use the <strong>arrow keys</strong> on your keyboard to play the game. "+n+"<p></p>";var a=document.createElement("button");a.appendChild(document.createTextNode("Play Game"));var o=function(){SNAKE.removeEventListener(window,"keyup",d,!1),e.style.display="none",y.setBoardState(1),y.getBoardContainer().focus(),document.getElementById("pause").style.display="inline-block"},d=function(e){if(!e)var e=window.event;var t=e.which?e.which:e.keyCode;32!==t&&13!==t||o()};return SNAKE.addEventListener(window,"keyup",d,!1),SNAKE.addEventListener(a,"click",o,!1),e.appendChild(t),e.appendChild(a),e}(),g=b("You died :(","sbTryAgain","snake-try-again-dialog"),p=b("You win! :D","sbWin","snake-win-dialog"),SNAKE.addEventListener(s,"keyup",function(e){if(!e)e=window.event;return e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},!1),s.className="snake-game-container",h.style.zIndex=1e4,s.appendChild(h),s.appendChild(r),s.appendChild(c),s.appendChild(u),s.appendChild(m),s.appendChild(g),s.appendChild(p),l=new SNAKE.Snake({playingBoard:y,startRow:2,startCol:2}),d=new SNAKE.Food({playingBoard:y}),m.style.zIndex=1e3}function b(e,t,n){var a=document.createElement("div");a.id=t+k,a.className=n;var o=document.createElement("div");o.innerHTML="<p></p>"+e+"<p></p>";var d=document.createElement("button");d.appendChild(document.createTextNode("Play Again?"));var l=function(){return a.style.display="none",y.resetBoard(),y.setBoardState(1),y.getBoardContainer().focus(),location.reload(),!1};return SNAKE.addEventListener(window,"keyup",function(e){if(0===w&&"block"===a.style.display){e||(e=window.event);var t=e.which?e.which:e.keyCode;32!==t&&13!==t||l()}},!0),SNAKE.addEventListener(d,"click",l,!1),a.appendChild(o),a.appendChild(d),a}function H(e){var n=Math.max(t(l.snakeBody),t({tmp:{elm:d.getFoodElement()}}));s.removeChild(e),s.appendChild(e),e.style.zIndex=n,e.style.display="block",y.setBoardState(0)}y.grid=[],y.setPaused=function(e){E=e,l.setPaused(e),E?(h.style.display="block",document.getElementById("pause").innerHTML="Play"):(h.style.display="none",document.getElementById("pause").innerHTML="Pause")},y.getPaused=function(){return E},y.resetBoard=function(){SNAKE.removeEventListener(s,"keydown",i,!1),l.reset(),c.innerHTML="Score: 1",y.setupPlayingField()},y.getBoardState=function(){return w},y.setBoardState=function(e){w=e},y.getGridFoodValue=function(){return-1},y.getPlayingFieldElement=function(){return r},y.setBoardContainer=function(e){"string"==typeof e&&(e=document.getElementById(e)),e!==s&&(s=e,r=null,y.setupPlayingField())},y.getBoardContainer=function(){return s},y.getBlockWidth=function(){return 20},y.getBlockHeight=function(){return 20},y.setupPlayingField=function(){var e,t,o,m;r||S(),!0===f.fullScreen?(o=0,m=0,e=n()-20,t=a()-20):(o=f.top,m=f.left,e=f.width,t=f.height);var g=2*y.getBlockWidth()+e%y.getBlockWidth(),p=Math.min(v*y.getBlockWidth()-g,e-g),h=3*y.getBlockHeight()+t%y.getBlockHeight(),k=Math.min(B*y.getBlockHeight()-h,t-h);s.style.left=m+"px",s.style.top=o+"px",s.style.width=e+"px",s.style.height=t+"px",r.style.left=y.getBlockWidth()+"px",r.style.top=y.getBlockHeight()+"px",r.style.width=p+"px",r.style.height=k+"px";var w=h-y.getBlockHeight(),E=y.getBlockHeight()+k+Math.round((w-30)/2)+"px";c.style.top=E,c.style.left="0px",u.style.top=E,u.style.right="0px",y.grid=[];for(var b=p/y.getBlockWidth()+2,H=k/y.getBlockHeight()+2,N=0;N<H;N++){y.grid[N]=[];for(var x=0;x<b;x++)y.grid[N][x]=0===x||0===N||x===b-1||N===H-1?1:0}function P(e){var t=0;switch(e){case"up":t=38;break;case"right":t=39;break;case"down":t=40;break;case"left":t=37;break;case"pause":t=32}return t}d.randomlyPlaceFood(),i=function(e){if(!e)e=window.event;var t=e.which?e.which:e.keyCode;if("up"!=e.target.id&&"right"!=e.target.id&&"down"!=e.target.id&&"left"!=e.target.id&&"pause"!=e.target.id||(t=P(e.target.id)),1===y.getBoardState()){if(!(t>=37&&t<=40)&&87!==t&&65!==t&&83!==t&&68!==t)return;SNAKE.removeEventListener(s,"keydown",i,!1),SNAKE.removeEventListener(document.getElementById("pause"),"click",i,!1),document.querySelectorAll("#game-pad-wrapper span").forEach(function(e){SNAKE.removeEventListener(e,"click",i,!1)}),i=function(e){if(!e)e=window.event;var t=e.which?e.which:e.keyCode;return"up"!=e.target.id&&"right"!=e.target.id&&"down"!=e.target.id&&"left"!=e.target.id&&"pause"!=e.target.id||(t=P(e.target.id)),32===t&&(0!=y.getBoardState()&&y.setPaused(!y.getPaused()),setTimeout(function(){document.getElementById("game-area").focus()},10)),l.handleArrowKeys(t),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},SNAKE.addEventListener(s,"keydown",i,!1),document.querySelectorAll("#game-pad-wrapper span").forEach(function(e){SNAKE.addEventListener(e,"click",i,!1)}),SNAKE.addEventListener(document.getElementById("pause"),"click",i,!1),l.rebirth(),l.handleArrowKeys(t),y.setBoardState(2),l.go()}return e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},SNAKE.addEventListener(s,"keydown",i,!1),SNAKE.addEventListener(document.getElementById("pause"),"click",i,!1),document.querySelectorAll("#game-pad-wrapper span").forEach(function(e){SNAKE.addEventListener(e,"click",i,!1)})},y.foodEaten=function(){(c.innerHTML="Score: "+l.snakeLength,l.snakeLength>localStorage.jsSnakeHighScore)&&(new Audio("audio/highscore.mp3").play(),localStorage.setItem("jsSnakeHighScore",l.snakeLength),u.innerHTML="Highscore: "+localStorage.jsSnakeHighScore);return!!d.randomlyPlaceFood()},y.handleDeath=function(){H(g)},y.handleWin=function(){H(p)},f.fullScreen=void 0!==f.fullScreen&&f.fullScreen,f.top=void 0===f.top?0:f.top,f.left=void 0===f.left?0:f.left,f.width=void 0===f.width?n()-20:f.width,a()<=640?f.height=void 0===f.height?Math.round(a()/1.45):f.height:f.height=void 0===f.height?Math.round(a()/1.35):f.height,f.fullScreen&&SNAKE.addEventListener(window,"resize",function(){y.setupPlayingField()},!1),y.setBoardState(0),f.boardContainer&&y.setBoardContainer(f.boardContainer),document.getElementById("select").onchange=function(){function e(e){document.getElementById("style").setAttribute("href",e)}switch(document.getElementById("select").selectedIndex){case 0:e("css/light-theme.css?"+Math.random());break;case 1:e("css/dark-theme.css?"+Math.random());break;default:e("css/light-theme.css?"+Math.random())}setTimeout(function(){document.getElementById("game-area").focus()},10)}}}();